<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="HIIT Runner">
  <meta name="theme-color" content="#3b82f6">
  <title>HIIT Runner - Treino de Corrida</title>
  
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%233b82f6' width='100' height='100' rx='20'/><text x='50' y='70' text-anchor='middle' font-size='60' fill='white'>üèÉ</text></svg>">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
      overscroll-behavior: none;
      -webkit-tap-highlight-color: transparent;
    }
    * {
      -webkit-touch-callout: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const Play = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" {...props}>
        <path d="M5 3l14 9-14 9V3z"/>
      </svg>
    );
    
    const Pause = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" {...props}>
        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
      </svg>
    );
    
    const RotateCcw = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
      </svg>
    );
    
    const Plus = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M12 5v14M5 12h14"/>
      </svg>
    );
    
    const Trash2 = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
        <line x1="10" x2="10" y1="11" y2="17"/>
        <line x1="14" x2="14" y1="11" y2="17"/>
      </svg>
    );
    
    const Edit2 = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
      </svg>
    );
    
    const Check = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M20 6 9 17l-5-5"/>
      </svg>
    );
    
    const X = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M18 6 6 18M6 6l12 12"/>
      </svg>
    );
    
    const Volume2 = ({ size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" {...props}>
        <path d="M11 5 6 9H2v6h4l5 4V5zM15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"/>
      </svg>
    );

    function HIITRunner() {
      const [activeTab, setActiveTab] = useState('timer');
      const [isRunning, setIsRunning] = useState(false);
      const [currentPhase, setCurrentPhase] = useState('run');
      const [timeLeft, setTimeLeft] = useState(60);
      const [runTime, setRunTime] = useState(60);
      const [walkTime, setWalkTime] = useState(60);
      const [rounds, setRounds] = useState(5);
      const [currentRound, setCurrentRound] = useState(1);
      const [workouts, setWorkouts] = useState(() => {
        try {
          const saved = localStorage.getItem('hiit-workouts');
          return saved ? JSON.parse(saved) : [];
        } catch {
          return [];
        }
      });
      const [newWorkout, setNewWorkout] = useState('');
      const [editingId, setEditingId] = useState(null);
      const [editText, setEditText] = useState('');
      const [wakeLock, setWakeLock] = useState(null);
      
      const audioContextRef = useRef(null);
      const beepSoundRef = useRef(null);
      const finishSoundRef = useRef(null);

      useEffect(() => {
        try {
          localStorage.setItem('hiit-workouts', JSON.stringify(workouts));
        } catch (e) {
          console.log('Erro ao salvar treinos');
        }
      }, [workouts]);

      useEffect(() => {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioContextRef.current = new AudioContext();
        
        beepSoundRef.current = () => {
          const ctx = audioContextRef.current;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.frequency.value = 800;
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.5, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
          osc.start(ctx.currentTime);
          osc.stop(ctx.currentTime + 0.5);
        };

        finishSoundRef.current = () => {
          const ctx = audioContextRef.current;
          if (ctx.state === 'suspended') ctx.resume();
          
          const osc1 = ctx.createOscillator();
          const osc2 = ctx.createOscillator();
          const gain = ctx.createGain();
          osc1.connect(gain);
          osc2.connect(gain);
          gain.connect(ctx.destination);
          osc1.frequency.value = 523.25;
          osc2.frequency.value = 659.25;
          osc1.type = 'sine';
          osc2.type = 'sine';
          gain.gain.setValueAtTime(0.5, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1);
          osc1.start(ctx.currentTime);
          osc2.start(ctx.currentTime);
          osc1.stop(ctx.currentTime + 1);
          osc2.stop(ctx.currentTime + 1);
        };
      }, []);

      useEffect(() => {
        if (isRunning && 'wakeLock' in navigator) {
          navigator.wakeLock.request('screen').then(lock => setWakeLock(lock)).catch(() => {});
        }
        return () => {
          if (wakeLock) {
            wakeLock.release();
            setWakeLock(null);
          }
        };
      }, [isRunning]);

      const playAlert = (isFinish) => {
        if (isFinish) {
          finishSoundRef.current();
          setTimeout(() => finishSoundRef.current(), 300);
          setTimeout(() => finishSoundRef.current(), 600);
        } else {
          beepSoundRef.current();
          setTimeout(() => beepSoundRef.current(), 200);
        }
        
        if ('vibrate' in navigator) {
          navigator.vibrate(isFinish ? [200, 100, 200, 100, 200] : [100, 50, 100]);
        }
      };

      useEffect(() => {
        let interval;
        if (isRunning && timeLeft > 0) {
          interval = setInterval(() => {
            setTimeLeft(prev => {
              if (prev === 4) playAlert(false);
              return prev - 1;
            });
          }, 1000);
        } else if (isRunning && timeLeft === 0) {
          if (currentPhase === 'run') {
            playAlert(false);
            setCurrentPhase('walk');
            setTimeLeft(walkTime);
          } else {
            if (currentRound < rounds) {
              playAlert(false);
              setCurrentPhase('run');
              setTimeLeft(runTime);
              setCurrentRound(prev => prev + 1);
            } else {
              playAlert(true);
              setIsRunning(false);
            }
          }
        }
        return () => clearInterval(interval);
      }, [isRunning, timeLeft, currentPhase, runTime, walkTime, rounds, currentRound]);

      const toggleTimer = async () => {
        if (!isRunning && audioContextRef.current && audioContextRef.current.state === 'suspended') {
          await audioContextRef.current.resume();
        }
        setIsRunning(!isRunning);
      };

      const resetTimer = () => {
        setIsRunning(false);
        setCurrentPhase('run');
        setTimeLeft(runTime);
        setCurrentRound(1);
      };

      const addWorkout = () => {
        if (newWorkout.trim()) {
          setWorkouts([...workouts, { id: Date.now(), text: newWorkout, completed: false }]);
          setNewWorkout('');
        }
      };

      const toggleWorkout = (id) => {
        setWorkouts(workouts.map(w => w.id === id ? { ...w, completed: !w.completed } : w));
      };

      const deleteWorkout = (id) => {
        setWorkouts(workouts.filter(w => w.id !== id));
      };

      const startEdit = (workout) => {
        setEditingId(workout.id);
        setEditText(workout.text);
      };

      const saveEdit = (id) => {
        setWorkouts(workouts.map(w => w.id === id ? { ...w, text: editText } : w));
        setEditingId(null);
        setEditText('');
      };

      const cancelEdit = () => {
        setEditingId(null);
        setEditText('');
      };

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const progress = currentPhase === 'run' 
        ? ((runTime - timeLeft) / runTime) * 100
        : ((walkTime - timeLeft) / walkTime) * 100;

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
          <div className="bg-white border-b border-gray-200">
            <div className="max-w-md mx-auto px-4 pt-12 pb-4">
              <h1 className="text-3xl font-bold text-gray-900 tracking-tight">HIIT Runner</h1>
              {isRunning && (
                <div className="flex items-center gap-2 mt-2 text-sm text-green-600">
                  <Volume2 size={16} className="animate-pulse" />
                  <span>Som ativo</span>
                </div>
              )}
            </div>
          </div>

          <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
            <div className="max-w-md mx-auto flex">
              <button
                onClick={() => setActiveTab('timer')}
                className={`flex-1 py-3 text-center font-medium transition-colors ${
                  activeTab === 'timer' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-gray-500'
                }`}
              >
                Cron√¥metro
              </button>
              <button
                onClick={() => setActiveTab('workout')}
                className={`flex-1 py-3 text-center font-medium transition-colors ${
                  activeTab === 'workout' ? 'text-blue-500 border-b-2 border-blue-500' : 'text-gray-500'
                }`}
              >
                Treino do Dia
              </button>
            </div>
          </div>

          <div className="max-w-md mx-auto p-4 pb-8">
            {activeTab === 'timer' ? (
              <div className="space-y-6">
                <div className="bg-white rounded-3xl shadow-sm p-8 text-center">
                  <div className="mb-6">
                    <div className={`inline-block px-6 py-2 rounded-full text-sm font-semibold ${
                      currentPhase === 'run' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'
                    }`}>
                      {currentPhase === 'run' ? 'üèÉ‚Äç‚ôÇÔ∏è Correndo' : 'üö∂‚Äç‚ôÇÔ∏è Andando'}
                    </div>
                  </div>
                  
                  <div className="relative inline-flex items-center justify-center w-64 h-64 mb-6">
                    <svg className="transform -rotate-90 w-64 h-64">
                      <circle cx="128" cy="128" r="120" stroke="#e5e7eb" strokeWidth="8" fill="none" />
                      <circle
                        cx="128" cy="128" r="120"
                        stroke={currentPhase === 'run' ? '#ef4444' : '#10b981'}
                        strokeWidth="8" fill="none"
                        strokeDasharray={`${2 * Math.PI * 120}`}
                        strokeDashoffset={`${2 * Math.PI * 120 * (1 - progress / 100)}`}
                        strokeLinecap="round"
                        className="transition-all duration-1000"
                      />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                      <div className={`text-6xl font-bold mb-2 ${timeLeft <= 3 && isRunning ? 'text-red-500 animate-pulse' : 'text-gray-900'}`}>
                        {formatTime(timeLeft)}
                      </div>
                      <div className="text-sm text-gray-500 font-medium">
                        Round {currentRound}/{rounds}
                      </div>
                    </div>
                  </div>

                  <div className="flex justify-center gap-4 mb-6">
                    <button
                      onClick={toggleTimer}
                      className={`w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-all ${
                        isRunning ? 'bg-orange-500 hover:bg-orange-600' : 'bg-blue-500 hover:bg-blue-600'
                      } text-white`}
                    >
                      {isRunning ? <Pause size={28} /> : <Play size={28} style={{marginLeft: '2px'}} />}
                    </button>
                    <button
                      onClick={resetTimer}
                      className="w-16 h-16 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center shadow-lg transition-all"
                    >
                      <RotateCcw size={24} />
                    </button>
                  </div>

                  {!isRunning && (
                    <div className="text-xs text-gray-500 bg-gray-50 rounded-2xl p-4">
                      üí° <strong>Dica:</strong> Mantenha o app aberto para receber alertas sonoros durante o treino!
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-3xl shadow-sm p-6 space-y-4">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">Configura√ß√µes</h3>
                  
                  <div className="space-y-3">
                    <div className="flex items-center justify-between py-2">
                      <label className="text-gray-700 font-medium">Tempo Correndo</label>
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => setRunTime(Math.max(10, runTime - 10))}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          -
                        </button>
                        <span className="w-16 text-center font-semibold text-gray-900">{runTime}s</span>
                        <button
                          onClick={() => setRunTime(runTime + 10)}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          +
                        </button>
                      </div>
                    </div>

                    <div className="flex items-center justify-between py-2">
                      <label className="text-gray-700 font-medium">Tempo Andando</label>
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => setWalkTime(Math.max(10, walkTime - 10))}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          -
                        </button>
                        <span className="w-16 text-center font-semibold text-gray-900">{walkTime}s</span>
                        <button
                          onClick={() => setWalkTime(walkTime + 10)}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          +
                        </button>
                      </div>
                    </div>

                    <div className="flex items-center justify-between py-2">
                      <label className="text-gray-700 font-medium">Rounds</label>
                      <div className="flex items-center gap-2">
                        <button
                          onClick={() => setRounds(Math.max(1, rounds - 1))}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          -
                        </button>
                        <span className="w-16 text-center font-semibold text-gray-900">{rounds}</span>
                        <button
                          onClick={() => setRounds(rounds + 1)}
                          className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-bold text-gray-700"
                          disabled={isRunning}
                        >
                          +
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            ) : (
              <div className="space-y-4">
                <div className="bg-white rounded-3xl shadow-sm p-4">
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={newWorkout}
                      onChange={(e) => setNewWorkout(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && addWorkout()}
                      placeholder="Adicionar novo treino..."
                      className="flex-1 px-4 py-3 bg-gray-50 rounded-2xl border-none focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <button
                      onClick={addWorkout}
                      className="w-12 h-12 rounded-full bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center shadow-lg transition-all"
                    >
                      <Plus size={24} />
                    </button>
                  </div>
                </div>

                <div className="space-y-2">
                  {workouts.length === 0 ? (
                    <div className="bg-white rounded-3xl shadow-sm p-8 text-center">
                      <div className="text-4xl mb-3">üèÉ‚Äç‚ôÄÔ∏è</div>
                      <p className="text-gray-500">Nenhum treino adicionado ainda.</p>
                      <p className="text-sm text-gray-400 mt-1">Adicione seus treinos acima!</p>
                    </div>
                  ) : (
                    workouts.map((workout) => (
                      <div
                        key={workout.id}
                        className="bg-white rounded-2xl shadow-sm p-4 flex items-center gap-3 transition-all hover:shadow-md"
                      >
                        <button
                          onClick={() => toggleWorkout(workout.id)}
                          className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${
                            workout.completed ? 'bg-blue-500 border-blue-500' : 'border-gray-300 hover:border-blue-500'
                          }`}
                        >
                          {workout.completed && <Check size={16} className="text-white" />}
                        </button>
                        
                        {editingId === workout.id ? (
                          <>
                            <input
                              type="text"
                              value={editText}
                              onChange={(e) => setEditText(e.target.value)}
                              className="flex-1 px-3 py-1 bg-gray-50 rounded-lg border-none focus:outline-none focus:ring-2 focus:ring-blue-500"
                              autoFocus
                            />
                            <button
                              onClick={() => saveEdit(workout.id)}
                              className="text-green-600 hover:text-green-700"
                            >
                              <Check size={20} />
                            </button>
                            <button
                              onClick={cancelEdit}
                              className="text-red-600 hover:text-red-700"
                            >
                              <X size={20} />
                            </button>
                          </>
                        ) : (
                          <>
                            <span className={`flex-1 text-gray-900 ${workout.completed ? 'line-through text-gray-400' : ''}`}>
                              {workout.text}
                            </span>
                            <button
                              onClick={() => startEdit(workout)}
                              className="text-gray-400 hover:text-blue-500 transition-colors"
                            >
                              <Edit2 size={18} />
                            </button>
                            <button
                              onClick={() => deleteWorkout(workout.id)}
                              className="text-gray-400 hover:text-red-500 transition-colors"
                            >
                              <Trash2 size={18} />
                            </button>
                          </>
                        )}
                      </div>
                    ))
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<HIITRunner />, document.getElementById('root'));
  </script>
</body>
</html>
